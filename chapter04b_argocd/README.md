# chapter04b_argocd
## GitOpsとCI/CDについて
CI/CDは、継続的インテグレーション（CI）と継続的デリバリー/デプロイメント（CD）を実現するための手法です。
CIは、アプリケーションのビルド、テスト、およびコードの統合を自動化するプロセス
CDは、アプリケーションのデプロイメントを自動化するプロセスです。
テストやデプロイを自動化することで、オペミスや作業量を減らすことで余ったリソースでアリケーションやソフトウェアの品質を高めたり、リソースサイクルを早めることを目的としている。

GitOpsは、CI/CDを実現するための手法の一つで、Gitのリポジトリの変更をトリガーにCI/CDを実行することで、アプリケーションのデプロイメントを自動化するプロセスです。


## Argo CDについて 
Kubrnetes用のGitOpsツールで、Gitリポジトリに格納されたマニフェストをデプロイすることができる。WEB GUIとCLIの両方で操作することができ、アプリケーションやKuberenetesのリソースの状態を可視化し簡単に管理する事が可能になっています。
ArgoCDはGitHub等からのWebhookを受け取り、Gitリポジトリに格納されたマニフェストをデプロイすることができるため、開発者のコードPushやPRをトリガーにデプロイまで実行することができます。


## Argo CDのステータスとRefresh/Hard Refresh/Sync の違いについて
### Argo CDのアーキテクチャ
![image](https://argo-cd.readthedocs.io/en/stable/assets/argocd_architecture.png)


Argo CDは三つのコアコンポーネントで構成されています。
- API Server
- Repository Server
- Application Controller
#### API Server
* アプリケーションとステータスの監視
* アプリケーション操作の呼び出し (同期、ロールバック、ユーザー定義アクションなど)
* リポジトリとクラスターの認証情報の管理 (K8s シークレットとして保存)
* Git Webhook イベントのlistener/forwarder

#### Repository Server
* 同期したGitリポジトリの管理 
* テンプレート固有の設定: パラメーター、helm value.yaml 

#### Application Controller
* デプロイしたアプリケーションと同期しているGitリポジトリの差分管理
* 変更を検知した際に、必要に応じた処理を行う


### RefreshとHardRefreshとSyncで行われること
これらの三つの処理は、GitレポジトリとArgo CDの状態を同期させるための処理ですが細かな違い存在します。。
#### Refresh
最新のGitのコードとRepository Server内にあるコードを比較し、差分を反映する。
Application Controllerによって要求され、通常の更新はデフォルトで3分ごとに行われる。


#### HardRefresh
HelmやKustomizeなどのコードから生成されたマニフェストをキャッシュしているマニフェストキャッシュをクリアし、新たにRefresh処理を行う操作です。これにより、マニフェストの変更の有無にかかわらず、マニフェストを再生成できます。

デフォルトで24時間ごとに、マニフェストキャッシュの有効期限が切れたときに行われる。

#### Sync
Kubernetes clusterに変更を反映する事で、アプリケーションをGitリポジトリの状態に同期させる処理です。

### OutOfSync/Synced
アプリケーションがGitリポジトリの定義と設定と一致しているかどうかを示すステータスです。
#### OutOfSync
Gitリポジトリとアプリケーションの状態が一致せず、アプリケーションに変更があったか、同期エラーが発生したことを示します。
#### Synced
Gitリポジトリとアプリケーションの状態が一致し、アプリケーションが期待どおりに機能していることを示します。

### Healthy/Degrated/Processing 
アプリケーションの状態を示す異なるステータスで、アプリケーションの健全性や動作状態を表現します
#### Healthy
アプリケーションのコンポーネントやサーバーが期待どおりに応答し、エラーや障害がない状態です。
#### Degrated
アプリケーションが完全に停止していないが、一部の問題が存在する状態です。
#### Processing
アプリケーションやサービスが現在、新しいリクエストやデプロイメントなどの操作を処理していることを示し"Healthy" または "Degraded" の状態に変わります。
## Kustomize manifest
アプリケーションのマニフェストファイル（YAML形式のKubernetesリソース定義）をカスタマイズし、環境ごとに異なる設定や変更を適用するのに利用します。
## Helm
Kubernetesアプリケーションのパッケージング、デプロイメント、および管理を簡素化するためのツールで、Kubernetesクラスター内でアプリケーションを簡単にデプロイできるようにするため利用します。
